name: Deploy to pub.dev

on: 
    workflow_dispatch:
        inputs:
            target-env:
              description: 'Select the target environment for deployment'
              required: true
              type: choice
              options:
                 - development
                 - production

    push:
      tags:
        - 'v[0-9]+.[0-9]+.[0-9]+*'

jobs:
    publish:
        runs-on: ubuntu-latest 
        permissions:
          id-token: write   # required for OIDC
          contents: read

        steps:
          - name: Checkout code
            uses: actions/checkout@v4

          - name: Set up Flutter
            uses: subosito/flutter-action@v2
            with:
              flutter-version: "3.35.0"
              channel: "stable"
              cache: true

          - name: Install dependencies
            run: flutter pub get

          - name: ðŸ§© Setup pub.dev credentials (OIDC)
            uses: flutter-actions/setup-pubdev-credentials@v1

          - name: ðŸ“¦ Install dependencies
            run: flutter pub get

          - name: ðŸš€ Publish to pub.dev
            run: flutter pub publish --force